# Butterfly

ButterflyëŠ” NestJS ê¸°ë°˜ì˜ ì‹¤ì‹œê°„ ê²Œì„ ì„œë²„ë¡œ, ë©€í‹°í”Œë ˆì´ì–´ ê²Œì„ì„ ìœ„í•œ ë¡œë¹„, ë§¤ì¹­, ì‹¤ì‹œê°„ í”Œë ˆì´ ê¸°ëŠ¥ì„ ë§Œë“¤ê³  ìˆìŠµë‹ˆë‹¤.

## ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

### ì„œë¹„ìŠ¤ êµ¬ì„± (Monorepo)

- **game-server**: gRPC ì„œë²„ (ì¶”í›„ í´ë¼ì´ì–¸íŠ¸ì™€ í†µì‹ ë°©ì‹ì„ restful apië¡œ ë³€ê²½ ì˜ˆì •. body í¬ë§·ë§Œ protobuf ì‚¬ìš©ì˜ˆì •)
  - ì‚¬ìš©ì ì¸ì¦ ë° ë¡œê·¸ì¸
  - ë¡œë¹„ ê´€ë¦¬ ë° í”Œë ˆì´ì–´ ë§¤ì¹­
  - ê²Œì„ ë£¸ ìƒì„± ë° ê´€ë¦¬

- **realtime-server** : WebSocket ì„œë²„
  - ì‹¤ì‹œê°„ ê²Œì„ í”Œë ˆì´
  - ê²Œì„ ë£¸ ìƒíƒœ ë™ê¸°í™”
  - í”Œë ˆì´ì–´ ê°„ í†µì‹ 

- **common**: ê³µí†µ ë¼ì´ë¸ŒëŸ¬ë¦¬
  - JWT ê¸°ë°˜ ì¸ì¦
  - Redis ìºì‹œ ê´€ë¦¬
  - ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°

### ë°ì´í„° ì €ì¥ì†Œ

- **MySQL**: ì‚¬ìš©ì ê³„ì •, í”Œë ˆì´ì–´ ì •ë³´
- **Redis**: ì„¸ì…˜ ê´€ë¦¬, ê²Œì„ ë£¸ ìƒíƒœ

### MSA 
- **game-server** ì™€ **realtime-server** ëŠ” ë³„ë„ë¡œ ë– ìˆìœ¼ë©°, ì¶”í›„ MSAë¡œ êµ¬ì„±í•´ë³´ê³ ì í•¨. Service Meshì™€ Istioì— ëŒ€í•´ ì•Œì•„ë³´ì (ê³µë¶€ëª©ì )
- grpc í†µì‹  (í˜„ì¬ unary ë°©ì‹ì´ë¼ streamingìœ¼ë¡œ ë³€ê²½í•´ì•¼í•¨) 

## âš ï¸ í˜„ì¬ ìƒíƒœ ë° ì•Œë ¤ì§„ ì´ìŠˆ

### ğŸš§ ê°œë°œ ì¤‘ì¸ ê¸°ëŠ¥
- ê¸°ë³¸ ê²Œì„ í”Œë ˆì´ ë¡œì§ êµ¬í˜„ ì¤‘
- ë§¤ì¹­ ì•Œê³ ë¦¬ì¦˜ ê°œì„  í•„ìš”
- ì—ëŸ¬ ì²˜ë¦¬ ë° ì˜ˆì™¸ ìƒí™© ëŒ€ì‘ ê°•í™”

### ğŸ› ì•Œë ¤ì§„ ë¬¸ì œì 
- ì¼ë¶€ í…ŒìŠ¤íŠ¸ê°€ ë¶ˆì•ˆì •í•¨ 
- ê¸°ë³¸ í”Œë ˆì´ ë¡œì§ í™•ì¸ë‹¨ê³„ë¡œ, íŠ¸ë˜í”½ì´ë‚˜ ì´ˆì €ì§€ì—° ë ˆì´í„´ì‹œë¥¼ ìœ„í•œ ì„¤ê³„ëŠ” ì•„ì§ ê³ ë ¤ë˜ì§€ ì•ŠìŒ
- WebSocket ì—°ê²° í•´ì œ ì‹œ ì •ë¦¬ ë¡œì§ ë¯¸ì™„ì„±

### ğŸ“‹ TODO
- [ ] ê¸°ë³¸ ê²Œì„ í”Œë ˆì´ ë¡œì§ ì™„ì„±
- [ ] ë§ì€ íŠ¸ë˜í”½ + ë©€í‹° ë¦¬ì „ ìœ ì € í˜ë™ í”Œë ˆì´ ê³ ë ¤ ê°œì„ 
- [ ] ë¶€í•˜ í…ŒìŠ¤íŠ¸ ë° ì„±ëŠ¥ ìµœì í™”
- [ ] ë¡œê·¸ ì‹œìŠ¤í…œ êµ¬ì¶• (k8s pod ë‚´ì— ê°™ì´ ë– ìˆëŠ” ì—ì´ì „íŠ¸ê°€ ê²Œì„ì„œë²„ì˜ ë¡œê·¸ë¥¼ ìˆ˜ì§‘í•˜ì—¬ ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œ ì „ì†¡ -> ì»¨ìŠˆë¨¸ ê°œë…ì´ ìŠ¤íŠ¸ë¦¼ì—ì„œ ì»¨ìŠ˜í•˜ì—¬ ê°€ê³µ ì ì¬ ê³¼ì •ì´ 1ì°¨ ëª©í‘œ. ì–´ë–¤ ê²ƒì„ ì‚¬ìš©í• ì§€ ì•Œì•„ë´ì•¼ í•¨)
- [ ] ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ ì¶”ê°€ (datadog - Infra Proê¸‰ì—ì„œ ì œê³µí•˜ëŠ” ë¦¬ì†ŒìŠ¤ ìƒíƒœ ë¶„ì„ê³¼ trace ê¸°ëŠ¥ì´ ë„ˆë¬´ ì¢‹ë˜ë° ë¹„ìš©ì„ ë´ì•¼í•¨)
- [ ] CI/CD ìë™í™” êµ¬ì¶• (gitops)
- [ ] k8s helm, terraform
- [ ] ì–´ë“œë¯¼ (frontend ë°”ì´ë¸Œì½”ë”© ëª©í‘œ)
- [ ] AI github PR ë¦¬ë·° (ê¶ê¸ˆ!)  


## ì‹œì‘í•˜ê¸°

### 1. ì˜ì¡´ì„± ì„¤ì¹˜

```bash
pnpm install
```

### 2. ë¡œì»¬ ì¸í”„ë¼ ì‹œì‘

```bash
# MySQLê³¼ Redis ì»¨í…Œì´ë„ˆ ì‹œì‘
docker-compose -f environments/local/docker-compose.yml up -d
```

### 3. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ë§ˆì´ê·¸ë ˆì´ì…˜

```bash
# ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
pnpm run migration:run:game
```

### 4. ì„œë²„ ì‹¤í–‰

```bash
# í„°ë¯¸ë„ 1: game-server ì‹œì‘ (gRPC ì„œë²„)
pnpm run start:game:dev

# í„°ë¯¸ë„ 2: realtime-server ì‹œì‘ (WebSocket ì„œë²„)
pnpm run start:rt:dev
```

---

